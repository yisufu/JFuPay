import{x as L,_ as R}from"./index-B0iOz79E.js";import{F as T}from"./index-tQazVPhs.js";import{a as A}from"./pay-CU2cU_nZ.js";import{e as M,p as i,a as W,B as X,m as r,W as Y,o as s,N as u,O as a,k as _,l as v,U as C,V as x,v as y,Z,h as I,Y as q,X as z,a8 as k}from"./vue-DkQzphiS.js";import"./index-CJwZD0Ka.js";import"./index-DJv0ClnV.js";const G={class:"ba-operate-form ba-config-form"},H={class:"dialog-footer"},K=M({__name:"configForm",props:{modelValue:{type:Boolean,default:!1},channelId:{type:[String,Number],default:""},pluginId:{type:[String,Number],default:""},config:{type:String,default:""}},emits:["update:modelValue","success"],setup(b,{emit:w}){const l=b,h=w,{t:d}=L.useI18n(),N=i(),f=i(!1),p=i(!1),m=i({}),t=W({});X(()=>l.modelValue,e=>{if(e&&l.pluginId&&(Object.keys(t).forEach(o=>delete t[o]),F(),l.config))try{const o=JSON.parse(l.config);Object.assign(t,o)}catch(o){console.error("解析配置失败:",o)}});const F=async()=>{f.value=!0;try{const e=await A(Number(l.pluginId));m.value=e.data.info||{}}catch(e){console.error("获取插件配置失败:",e),k.error("获取插件配置失败")}finally{f.value=!1}},S=e=>{switch(e){case"textarea":return"textarea";case"select":return"select";default:return"string"}},B=e=>{const o={};return e.type==="textarea"?o.rows=3:e.type==="select"&&e.options&&(o.content=e.options),o},g=()=>{h("update:modelValue",!1),Object.keys(t).forEach(e=>delete t[e])},O=async()=>{p.value=!0;try{h("success",{id:l.channelId,config:JSON.stringify(t)}),g()}catch(e){console.error("保存失败:",e),k.error("保存失败")}finally{p.value=!1}};return(e,o)=>{const E=r("el-alert"),j=r("el-form"),D=r("el-scrollbar"),V=r("el-button"),P=r("el-dialog"),U=Y("loading");return s(),u(P,{class:"ba-operate-dialog","close-on-click-modal":!1,"model-value":b.modelValue,onClose:g,title:"配置支付参数",width:"50%"},{footer:a(()=>[_("div",H,[v(V,{onClick:g},{default:a(()=>[C(x(y(d)("Cancel")),1)]),_:1}),v(V,{type:"primary",onClick:O,loading:p.value},{default:a(()=>[C(x(y(d)("Save")),1)]),_:1},8,["loading"])])]),default:a(()=>[Z((s(),u(D,{class:"ba-table-form-scrollbar"},{default:a(()=>[_("div",G,[m.value.inputs?(s(),u(j,{key:1,ref_key:"formRef",ref:N,model:e.formData,"label-position":"right","label-width":"120px"},{default:a(()=>[(s(!0),I(q,null,z(m.value.inputs,(n,c)=>(s(),I("div",{key:c},[v(T,{label:n.name,type:S(n.type),modelValue:t[c],"onUpdate:modelValue":J=>t[c]=J,prop:c,"input-attr":B(n),placeholder:n.note||y(d)("Please input field",{field:n.name})},null,8,["label","type","modelValue","onUpdate:modelValue","prop","input-attr","placeholder"])]))),128))]),_:1},8,["model"])):(s(),u(E,{key:0,type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:a(()=>o[0]||(o[0]=[_("p",null,"正在加载支付插件配置...",-1)])),_:1}))])]),_:1})),[[U,f.value]])]),_:1},8,["model-value"])}}}),le=R(K,[["__scopeId","data-v-1eecc1f1"]]);export{le as default};
